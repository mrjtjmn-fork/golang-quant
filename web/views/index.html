<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Go 量化交易平台</title>
</head>
<body>
  <h1>欢迎使用 Go 量化交易平台</h1>
  <p>功能开发中：获取数据、运行策略、回测展示</p>

  <!-- 获取价格按钮 -->
  <button onclick="getPrice()">获取价格 (AAPL)</button>
  <pre id="price-result"></pre>

  <!-- 回测按钮 -->
  <button onclick="runBacktest()">运行回测 (AAPL)</button>
  <pre id="result"></pre>

  <script>
    /**
     * 获取价格函数：点击按钮后向后端 /api/data?symbol=AAPL 发起 GET 请求
     */
    async function getPrice() {
      document.getElementById('price-result').innerText = '正在获取价格...';
      try {
        const resp = await fetch('/api/data?symbol=AAPL');
        let data;
        try {
          data = await resp.json();
        } catch (err) {
          throw new Error('服务器返回异常格式');
        }
        if (!resp.ok) {
          document.getElementById('price-result').innerText =
            '请求失败: ' + (data.error || ('网络错误：' + resp.status));
          return;
        }
        document.getElementById('price-result').innerText = JSON.stringify(data, null, 2);
      } catch (e) {
        document.getElementById('price-result').innerText = '请求失败: ' + e.message;
      }
    }

    /**
     * 回测函数，无需更改
     */
    async function runBacktest() {
      document.getElementById('result').innerText = '正在运行回测...';
      try {
        const resp = await fetch('/api/backtest?symbol=AAPL', { method: 'POST' });
        let data;
        try {
          data = await resp.json();
        } catch (err) {
          throw new Error('服务器返回异常格式');
        }
        if (!resp.ok) {
          document.getElementById('result').innerText =
            '请求失败: ' + (data.error || ('网络错误：' + resp.status));
          return;
        }
        // 展示信号和价格
        let output = `股票: ${data.symbol}\n最终资产: ${data.final_value}\n\n信号:\n`;
        if(data.signals && data.prices){
			for(let i=0; i<data.signals.length; i++){
				output += `Day ${i+1}: Price=${data.prices[i]}, Signal=${data.signals[i]}\n`;
			}
		} else {
			output += JSON.stringify(data, null, 2);
		}
		document.getElementById('result').innerText = output;
	  } catch (e) {
		document.getElementById('result').innerText = '请求失败: ' + e.message;
	  }
	}
  </script>
</body>
</html>
